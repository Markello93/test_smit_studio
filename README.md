
# Тестовое задание SMIT.Studio
  
## Краткое описание задачи 
  
Реализовать REST API сервис по расчёту стоимости страхования в зависимости от типа груза и объявленной стоимости (ОС).
-   Сервис должен посчитать стоимость страхования для запроса используя актуальный тариф.(Загружается через API)
    
-   Сервис возвращает (объявленную стоимость * rate) в зависимости от указанного в запросе типа груза и даты.
  
## Краткое описание структуры проекта  
  
Сервис построен на двухуровневой архитектуре и состоит из:   
1. слой представления (директория `/api`): получение и валидация данных, формирование ответов.  
2. слой работы с данными (директория `/service`): отвечает за получение/сохранение данных в базе данных. 
  
В проекте реализовано два endpoint-а:
- `POST /cargo/price/`- принимает данные о тарифах и товарах и возвращает стоимость страхования исходя из переданного тарифа
 - `POST /cargo/add_cargo/`- принимает данные о товарах и их стоимости для добавления данной информации в базу данных

 
     
## Инструкция по запуску проекта  
```bash  
git clone https://github.com:Markello93/test_smit_studio.git 
  
#### Переменные окружения  
Для работы приложения необходимы следующие переменные окружения  
(необходимо создать файл `.env` в корневой директории проекта)  
```dotenv 
# Общие настройки  
DB_HOST=postgres-cargo  # имя хоста (контейнера) базы данных  
DB_PORT=5432    # порт, на котором работает база данных  
# Настройки контейнера базы данных  
POSTGRES_USER=postgres      # имя суперпользователя postgres  
POSTGRES_PASSWORD=postgres  # пароль суперпользователя  
# Настройки приложения cargo  
CARGO_APP_DB_NAME=postgres                     # имя базы данных сервиса  
CARGO_APP_DB_USER=postgres                     # имя пользователя БД сервиса  
CARGO_APP_DB_PASSWORD='пароль от базы данных'  # Пароль пользователя БД  

```  

#### Запустите сборку контейнеров docker командами:  
```  
docker-compose build  
```
```  
docker-compose up -d  
```
Миграции через  aerich  применятся автоматически при запуске контейнера, зависимости автоматически устанавливаются через менеджер poetry.

#### Загрузите mock данные в базу данных
Загрузите заранее подготовленные данные из файла download_data.py командой :
```  
docker-compose run --rm cargo_back python download.py
```  
Загрузятся следующие данные, которые вы можете изменить в файле в ручную при желании:
'''
   {"cargo_type": "Glass", "price": "142200"},  
  {"cargo_type": "Other", "price": "1002200"},  
  {"cargo_type": "Paper", "price": "31100"},  
  {"cargo_type": "Plastic", "price": "20020"},  
  {"cargo_type": "Computers", "price": "12200"} 
'''

Либо отправьте POST запрос c json на адрес `/cargo/add_cargo/`.
Затем отправьте POST запрос c json на адрес`/cargo/price/`.
Примеры запросов доступны по адресу http://localhost:8080/docs
## Стек технологий, использованных в проекте  
* python 3.11  
* fastapi  
* tortoise-orm
* pydantic  
* aerich 
* asyncpg  

* uvicorn  
* python-dotenv  
* poetry  
* PostgreSQL 
  
  